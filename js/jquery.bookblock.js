!function(e,t,i){"use strict";var a,n,o=e.event;a=o.special.debouncedresize={setup:function(){e(this).on("resize",a.handler)},teardown:function(){e(this).off("resize",a.handler)},handler:function(e,t){var i=this,r=arguments,s=function(){e.type="debouncedresize",o.dispatch.apply(i,r)};n&&clearTimeout(n),t?s():n=setTimeout(s,a.threshold)},threshold:150};var r=e(t),s=t.Modernizr;e.BookBlock=function(t,i){this.$el=e(i),this._init(t)},e.BookBlock.defaults={speed:1e3,easing:"ease-in-out",shadows:!0,shadowSides:.2,shadowFlip:.1,perspective:1300,circular:!1,nextEl:"",prevEl:"",autoplay:!1,interval:3e3,keyboard:!0,onEndFlip:function(){return!1},onBeforeFlip:function(){return!1}},e.BookBlock.prototype={_init:function(t){this.options=e.extend(!0,{},e.BookBlock.defaults,t),this.$el.css("perspective",this.options.perspective),this.$items=this.$el.children(".bb-item"),this.itemsCount=this.$items.length,this.current=0,this.previous=-1,this.$current=this.$items.eq(this.current).show(),this.elWidth=this.$el.width();var i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};this.transEndEventName=i[s.prefixed("transition")]+".bookblock",this.support=s.csstransitions&&s.csstransforms3d,this._initEvents(),this.options.autoplay&&(this.options.circular=!0,this._startSlideshow())},_initEvents:function(){var t=this;""!==this.options.nextEl&&e(this.options.nextEl).on("click.bookblock",function(){return t._action("next"),!1}),""!==this.options.prevEl&&e(this.options.prevEl).on("click.bookblock",function(){return t._action("prev"),!1}),1==this.options.keyboard&&e(document).keydown(function(e){var i=e.keyCode||e.which,a={left:37,up:38,right:39,down:40};switch(i){case a.left:t._action("prev");break;case a.right:t._action("next")}}),r.on("debouncedresize",function(){t.elWidth=t.$el.width()})},_action:function(e,t){this._stopSlideshow(),this._navigate(e,t)},_navigate:function(e,t){return this.isAnimating?!1:(this.options.onBeforeFlip(this.current),this.isAnimating=!0,this.$current=this.$items.eq(this.current),t!==i?this.current=t:"next"===e?this.options.circular||this.current!==this.itemsCount-1?(this.previous=this.current,this.current=this.current<this.itemsCount-1?this.current+1:0):this.end=!0:"prev"===e&&(this.options.circular||0!==this.current?(this.previous=this.current,this.current=this.current>0?this.current-1:this.itemsCount-1):this.end=!0),this.$nextItem=!this.options.circular&&this.end?this.$current:this.$items.eq(this.current),this.support?this._layout(e):this._layoutNoSupport(e),void 0)},_layoutNoSupport:function(e){this.$items.hide(),this.$nextItem.show(),this.end=!1,this.isAnimating=!1;var t="next"===e&&this.current===this.itemsCount-1||"prev"===e&&0===this.current;this.options.onEndFlip(this.previous,this.current,t)},_layout:function(e){var t=this,i=this._addSide("left",e),a=this._addSide("middle",e),n=this._addSide("right",e),o=i.find("div.bb-overlay"),r=a.find("div.bb-flipoverlay:first"),s=a.find("div.bb-flipoverlay:last"),l=n.find("div.bb-overlay"),d=this.end?400:this.options.speed;if(this.$items.hide(),this.$el.prepend(i,a,n),a.css({transition:"all "+d+"ms "+this.options.easing}).on(this.transEndEventName,function(i){if("bb-page"===i.target.className){t.$el.children("div.bb-page").remove(),t.$nextItem.show(),t.end=!1,t.isAnimating=!1;var a="next"===e&&t.current===t.itemsCount-1||"prev"===e&&0===t.current;t.options.onEndFlip(t.previous,t.current,a)}}),"prev"===e&&a.css({transform:"rotateY(-180deg)"}),this.options.shadows&&!this.end){var c="next"===e?{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms"}:{transition:"opacity "+this.options.speed/2+"ms "+"linear",opacity:this.options.shadowSides},u="next"===e?{transition:"opacity "+this.options.speed/2+"ms "+"linear"}:{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms",opacity:this.options.shadowFlip},p="next"===e?{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms",opacity:this.options.shadowFlip}:{transition:"opacity "+this.options.speed/2+"ms "+"linear"},h="next"===e?{transition:"opacity "+this.options.speed/2+"ms "+"linear",opacity:this.options.shadowSides}:{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms"};r.css(u),s.css(p),o.css(c),l.css(h)}setTimeout(function(){var i="next"===e?"rotateY(-180deg)":"rotateY(0deg)";t.end&&(i="next"===e?"rotateY(-15deg)":"rotateY(-165deg)"),a.css({transform:i}),t.options.shadows&&!t.end&&(r.css({opacity:"next"===e?t.options.shadowFlip:0}),s.css({opacity:"next"===e?0:t.options.shadowFlip}),o.css({opacity:"next"===e?t.options.shadowSides:0}),l.css({opacity:"next"===e?0:t.options.shadowSides}))},30)},_addSide:function(t,i){var a;switch(t){case"left":a=e('<div class="bb-page"><div class="bb-back"><div class="bb-outer"><div class="bb-content" style="width:'+this.elWidth+'px"><div class="bb-inner">'+("next"===i?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",102);break;case"middle":a=e('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content" style="left:'+-this.elWidth/2+"px;width:"+this.elWidth+'px"><div class="bb-inner">'+("next"===i?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-flipoverlay"></div></div></div><div class="bb-back"><div class="bb-outer"><div class="bb-content" style="width:'+this.elWidth+'px"><div class="bb-inner">'+("next"===i?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-flipoverlay"></div></div></div></div>').css("z-index",103);break;case"right":a=e('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content" style="left:'+-this.elWidth/2+"px;width:"+this.elWidth+'px"><div class="bb-inner">'+("next"===i?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",101)}return a},_startSlideshow:function(){var e=this;this.slideshow=setTimeout(function(){e._navigate("next"),e.options.autoplay&&e._startSlideshow()},this.options.interval)},_stopSlideshow:function(){this.options.autoplay&&(clearTimeout(this.slideshow),this.options.autoplay=!1)},next:function(){this._action("next")},prev:function(){this._action("prev")},jump:function(e){return e-=1,e===this.current||e>=this.itemsCount||0>e?!1:(this._action(e>this.current?"next":"prev",e),void 0)},isActive:function(){return this.isAnimating},update:function(){var e=this.$items.eq(this.current);this.$items=this.$el.children(".bb-item"),this.itemsCount=this.$items.length,this.current=e.index()}};var l=function(e){t.console&&t.console.error(e)};e.fn.bookblock=function(t){var i=e.data(this,"bookblock");if("string"==typeof t){var a=Array.prototype.slice.call(arguments,1);this.each(function(){return i?e.isFunction(i[t])&&"_"!==t.charAt(0)?(i[t].apply(i,a),void 0):(l("no such method '"+t+"' for bookblock instance"),void 0):(l("cannot call methods on bookblock prior to initialization; attempted to call method '"+t+"'"),void 0)})}else this.each(function(){i?i._init():i=e.data(this,"bookblock",new e.BookBlock(t,this))});return i}}(jQuery,window);